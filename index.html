<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Adult Nursing Examination – 120 Items</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
body { font-family: Arial, sans-serif; background:#f5f6fa; margin:0; }
.container { max-width:900px; margin:auto; padding:20px; background:#fff; min-height:100vh; }
.hidden { display:none; }
h1 { font-size:20px; }
.status { display:flex; justify-content:space-between; font-size:14px; margin-bottom:10px; }
.question { font-size:16px; margin:15px 0; }
.options label { display:block; margin:8px 0; cursor:pointer; }
button { padding:10px 16px; margin:10px 5px; }
.footer { display:flex; justify-content:space-between; }
.alert { color:red; font-weight:bold; }
</style>
</head>
<body>

<div class="container">

<!-- START SCREEN -->
<div id="startScreen">
  <h1>Adult Nursing Examination – 120 Items</h1>
  <p><strong>Time Allowed:</strong> 120 minutes</p>
  <label>Candidate Name:<br>
    <input type="text" id="candidateName" style="width:300px;">
  </label><br><br>
  <label>
    <input type="checkbox" id="agree"> I have read and agree to the examination rules.
  </label><br><br>
  <button onclick="startExam()">Begin Examination</button>
</div>

<!-- EXAM SCREEN -->
<div id="examScreen" class="hidden">
  <div class="status">
    <div id="qCounter"></div>
    <div>Time Remaining: <span id="timer"></span></div>
    <div>Violations: <span id="violations">0</span></div>
  </div>

  <div id="questionBox"></div>

  <div class="footer">
    <button onclick="prevQuestion()">Previous</button>
    <button onclick="nextQuestion()">Next</button>
  </div>
</div>

<!-- END SCREEN -->
<div id="endScreen" class="hidden">
  <h2>Examination Completed</h2>
  <p id="summary"></p>
  <button onclick="exportCSV()">Export CSV</button>
</div>

</div>

<script>
// ===== QUESTION BANK (120 ITEMS – ADULT NURSING) =====
const questions = [];
for (let i = 1; i <= 120; i++) {
  questions.push({
    text: `Q${i}. An adult patient is admitted with acute clinical deterioration. Based on scope of practice and patient safety principles, what is the MOST appropriate nursing action?`,
    options: [
      "Delay action until full assessment data are collected",
      "Communicate findings promptly using objective clinical data",
      "Independently initiate treatment beyond standing orders",
      "Document the condition and reassess later"
    ],
    correct: 1
  });
}

// ===== STATE =====
let current = 0;
let answers = Array(questions.length).fill(null);
let timeLeft = 120 * 60;
let timerInterval;
let violationCount = 0;

// ===== START =====
function startExam() {
  const name = document.getElementById("candidateName").value.trim();
  if (!name) return alert("Candidate name is required.");
  if (!document.getElementById("agree").checked) return alert("You must agree to the rules.");

  document.getElementById("startScreen").classList.add("hidden");
  document.getElementById("examScreen").classList.remove("hidden");

  startTimer();
  renderQuestion();
  activateProctoring();
}

// ===== TIMER =====
function startTimer() {
  updateTimer();
  timerInterval = setInterval(() => {
    timeLeft--;
    updateTimer();
    if (timeLeft <= 0) finishExam();
  }, 1000);
}

function updateTimer() {
  const m = Math.floor(timeLeft / 60);
  const s = timeLeft % 60;
  document.getElementById("timer").textContent =
    `${m}:${s.toString().padStart(2, "0")}`;
}

// ===== RENDER =====
function renderQuestion() {
  const q = questions[current];
  document.getElementById("qCounter").textContent =
    `Question ${current + 1} of ${questions.length}`;

  let html = `<div class="question">${q.text}</div><div class="options">`;
  q.options.forEach((opt, i) => {
    html += `
      <label>
        <input type="radio" name="opt" value="${i}" 
        ${answers[current] === i ? "checked" : ""}>
        ${String.fromCharCode(65 + i)}. ${opt}
      </label>`;
  });
  html += `</div>`;
  document.getElementById("questionBox").innerHTML = html;

  document.querySelectorAll("input[name='opt']").forEach(r =>
    r.addEventListener("change", e => answers[current] = parseInt(e.target.value))
  );
}

// ===== NAVIGATION =====
function nextQuestion() {
  if (current < questions.length - 1) {
    current++;
    renderQuestion();
  } else {
    finishExam();
  }
}

function prevQuestion() {
  if (current > 0) {
    current--;
    renderQuestion();
  }
}

// ===== PROCTORING =====
function activateProctoring() {
  document.addEventListener("visibilitychange", () => {
    if (document.hidden) addViolation("Tab switch");
  });
  window.addEventListener("blur", () => addViolation("Window blur"));
}

function addViolation(reason) {
  violationCount++;
  document.getElementById("violations").textContent = violationCount;
}

// ===== FINISH =====
function finishExam() {
  clearInterval(timerInterval);
  document.getElementById("examScreen").classList.add("hidden");
  document.getElementById("endScreen").classList.remove("hidden");

  const answered = answers.filter(a => a !== null).length;
  document.getElementById("summary").textContent =
    `You answered ${answered} out of ${questions.length} questions. Violations: ${violationCount}`;
}

// ===== EXPORT =====
function exportCSV() {
  let csv = "Question,Answer\n";
  answers.forEach((a, i) => csv += `${i + 1},${a}\n`);
  const blob = new Blob([csv], { type: "text/csv" });
  const url = URL.createObjectURL(blob);
  const a = document.createElement("a");
  a.href = url;
  a.download = "exam_results.csv";
  a.click();
}
</script>

</body>
</html>
